$SoftwareName = "NVIDIA"
$vCenters = @(
    'vCenter01',
    'vCenter02',
    'vCenter03',
    'vCenter04',
    'vCenter05',
    'vCenter06',
    'vCenter07',
    'vCenter08',
)
$throttlejobs = 20
 
$GetVISoftwareVersion = {
        param($vmhost, $name, $session, $SoftwareName)
        connect-viserver $name -Session $session | out-null
        $esxcli = Get-EsxCli –VMHost (Get-VMHost $vmhost) –V2
        $itemList = $esxcli.software.vib.list.invoke() | Where-Object {$_.Name -like "*$SoftwareName*"} | select name,version
        $returnObject = New-Object -TypeName PSObject -Property @{
            hostname     =     $vmhost
            itemList     =     $itemList
        }
        $returnobject
}
 
 
 
foreach($vCenter in $vCenters){
$vcConnection = connect-viserver $vCenter
$vmhosts = Get-VMHost | Sort-Object $_.name
$returnList=@()
foreach ($vmhost in $vmhosts){
    Start-Job -ScriptBlock $GetVISoftwareVersion -ArgumentList "$($vmhost.name)",$vcConnection.name,$vcconnection.sessionid,$SoftwareName
    While ((Get-Job -State "Running").Count -ge $throttlejobs) {
    	write-host -NoNewline "."
    	start-sleep 1
    }
}
}
}
 
 
While (Get-Job -State "Running") {
    write-host -NoNewline "."
    start-sleep 1
}
 
$Jobs = Get-Job | Receive-Job #| select $itemlist, hostname
$GetVISoftwareVersionOutput=""
foreach ($job in $jobs){
$GetVISoftwareVersionOutput += $job.hostname + "`n  " + $job.itemList.Name + "`n    " + $job.itemList.Version + "`n`n"
}
Remove-Job *

cls

Write-Host $GetVISoftwareVersionOutput -foreground Green
